{"version":3,"file":"clip.js","sourceRoot":"","sources":["../../../../src/component/modules/workflow/clip.ts"],"names":[],"mappings":"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","sourcesContent":["import Data from '../data'\nimport Elements from '../elements'\nimport Direction from '../direction'\n\nclass Clip {\n\n  static run(direction) {\n    if (direction === Direction.top) {\n      return self.runTop();\n    }\n    if (direction === Direction.bottom) {\n      return self.runBottom();\n    }\n  }\n\n  static runTop() {\n    let viewportParams = Elements.viewport.getBoundingClientRect();\n    let viewportTop = viewportParams.top;\n    let delta = viewportParams.height * Data.padding;\n    let bottomLimit = viewportTop - delta;\n    let limit = Data.items.length - 1;\n    let i = 0, min = 0, cutHeight, found = -1;\n\n    const startIndex = Data.getFirstVisibleItemIndex();\n    const lastItem = Data.items[limit];\n    const lastElementBottom = lastItem.element.getBoundingClientRect().bottom;\n\n    // edge case: all items should be clipped\n    if (lastElementBottom < bottomLimit) {\n      cutHeight = Math.abs(Data.items[startIndex].element.getBoundingClientRect().top - lastElementBottom);\n      found = limit;\n    }\n    else {\n      for (i = startIndex; i <= limit; i++) {\n        const item = Data.items[i];\n        if(item.element.getBoundingClientRect().bottom > bottomLimit) {\n          found = i - 1;\n          break;\n        }\n      }\n      if(found >= startIndex) {\n        cutHeight = Data.items[found].element.getBoundingClientRect().bottom -\n          Data.items[startIndex].element.getBoundingClientRect().top;\n      }\n    }\n\n    if(found >= startIndex) {\n      for (i = startIndex; i <= found; i++) {\n        Data.items[i].element.style.display = 'none';\n      }\n      let paddingHeight = parseInt(Elements.paddingTop.style.height, 10) || 0;\n      Elements.paddingTop.style.height = (paddingHeight + cutHeight) + 'px';\n      Data.lastIndex = found === limit ? Data.items[limit].$index : null;\n      Data.items.splice(0, found + 1);\n      return true;\n    }\n\n    return false;\n  }\n\n  static runBottom() {\n    let viewportParams = Elements.viewport.getBoundingClientRect();\n    let viewportBottom = viewportParams.bottom;\n    let delta = viewportParams.height * Data.padding;\n    let topLimit = viewportBottom + delta;\n    let limit = Data.items.length - 1;\n    let i, cutHeight, found = -1;\n\n    const endIndex = Data.getLastVisibleItemIndex();\n    const firstItem = Data.items[0];\n    const firstElementTop = firstItem.element.getBoundingClientRect().top;\n\n    // edge case: all items should be clipped\n    if (firstElementTop > topLimit) {\n      cutHeight = Math.abs(Data.items[endIndex].element.getBoundingClientRect().bottom - firstElementTop);\n      found = 0;\n    }\n    else {\n      for (i = 0; i <= endIndex; i++) {\n        const element = Data.items[i].element;\n        if(element.getBoundingClientRect().top > topLimit) {\n          found = i;\n          break;\n        }\n      }\n      if(found >= 0) {\n        cutHeight = Data.items[endIndex].element.getBoundingClientRect().bottom -\n          Data.items[found].element.getBoundingClientRect().top;\n      }\n    }\n\n    if(found >= 0) {\n      for (i = found; i <= endIndex; i++) {\n        Data.items[i].element.style.display = 'none';\n      }\n      let paddingHeight = parseInt(Elements.paddingBottom.style.height, 10) || 0;\n      Elements.paddingBottom.style.height = (paddingHeight + cutHeight) + 'px';\n      Data.lastIndex = found === 0 ? Data.items[0].$index : null;\n      Data.items.splice(found, limit + 1 - found);\n      return true;\n    }\n\n    return false;\n  }\n\n}\n\nconst self = Clip;\nexport default Clip\n"]}