{"version":3,"file":"workflow.js","sourceRoot":"","sources":["../../../src/component/modules/workflow.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,UAAU,EAAE,MAAM,SAAS,CAAA;AAEpC,OAAO,KAAK,MAAM,kBAAkB,CAAA;AACpC,OAAO,MAAM,MAAM,mBAAmB,CAAA;AACtC,OAAO,IAAI,MAAM,iBAAiB,CAAA;AAClC,OAAO,MAAM,MAAM,mBAAmB,CAAA;AAEtC,OAAO,QAAQ,MAAM,YAAY,CAAA;AACjC,OAAO,SAAS,MAAM,aAAa,CAAA;AACnC,OAAO,IAAI,MAAM,QAAQ,CAAA;SAIJ,UAAC,KAAK,IAAK,OAAA,IAAI,EAAJ,CAAI,OAEtB,UAAC,OAAO;IAClB,QAAQ,CAAC,iBAAiB,GAAG,UAAC,KAAK;QAClC,OAAO,CAAC,cAAc,CAAC,YAAY,EAAE,CAAC;QACtC,MAAM,CAAC,KAAK,CAAC;KACd,CAAA;CACD,OAEM,UAAC,SAAS;IACf,OAAA,UAAU,CAAC,MAAM,CAAC,UAAA,QAAQ;QACxB,KAAK,CAAC,GAAG,CAAC,SAAS,CAAC;aACnB,IAAI,CAAC,UAAA,KAAK,IAAI,OAAA,QAAQ,CAAC,iBAAiB,CAAC,KAAK,CAAC,EAAjC,CAAiC,CAAC;aAChD,IAAI,CAAC,UAAA,KAAK,IAAI,OAAA,MAAM,CAAC,GAAG,CAAC,KAAK,EAAE,SAAS,CAAC,EAA5B,CAA4B,CAAC;aAC3C,IAAI,CAAC,UAAA,KAAK;YACT,MAAM,CAAC,GAAG,CAAC,SAAS,EAAE,KAAK,CAAC,CAAC;YAC7B,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC,QAAQ,CAAC,SAAS,CAAC;YAE5C,EAAE,CAAA,CAAC,IAAI,CAAC,GAAG,CAAC,SAAS,CAAC,QAAQ,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC;gBAC3C,QAAQ,CAAC,iBAAiB,CAAC,IAAI,CAAC,CAAC;aAClC;YACD,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC,QAAQ,CAAC,SAAS,CAAC;YAE5C,OAAO,CAAC,GAAG,CAAC,SAAS,GAAG,gBAAgB,CAAC,CAAC;YAC1C,QAAQ,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;YACzB,QAAQ,CAAC,QAAQ,EAAE,CAAC;SACrB,CAAC;aACD,KAAK,CAAC,UAAA,KAAK;YACV,OAAO,CAAC,GAAG,CAAC,OAAO,GAAG,SAAS,CAAC,CAAC;YACjC,KAAK,IAAI,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;YAC9B,QAAQ,CAAC,QAAQ,EAAE,CAAC;SACrB,CAAC,CAAA;KACH,CAAC;AAtBF,CAsBE,OAEC,UAAC,KAAK;IACT,IAAI,SAAS,CAAC;IACd,EAAE,CAAA,CAAC,OAAO,KAAK,KAAK,QAAQ,CAAC,CAAC,CAAC;QAC7B,SAAS,GAAG,KAAK,CAAC;KACnB;IACD,IAAI,CAAC,CAAC;;QAEJ,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;QACrB,SAAS,GAAG,SAAS,CAAC,WAAW,EAAE,CAAC;KACrC;IACD,EAAE,CAAA,CAAC,CAAC,SAAS,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC;QACjC,MAAM,CAAC;KACR;IAED,IAAM,GAAG,GAAG;QACV,OAAA,QAAQ,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC,SAAS,CAAC,GAAG,CAAC;IAAxC,CAAwC,CAAC;IAE3C,GAAG,EAAE,CAAC;CACP;AAtDH,IAAM,QAAQ,GAAG;IAEf,iBAAiB,IAAiB;IAElC,UAAU,IAKT;IAED,KAAK,IAuBD;IAEJ,GAAG,IAkBF;CACF,CAAC;AAEF,eAAe,QAAQ,CAAA","sourcesContent":["import { Observable } from 'rxjs/Rx'\n\nimport Fetch from './workflow/fetch'\nimport Render from './workflow/render'\nimport Clip from './workflow/clip'\nimport Adjust from './workflow/adjust'\n\nimport Elements from './elements'\nimport Direction from './direction'\nimport Data from './data'\n\nconst Workflow = {\n\n  runChangeDetector: (items) => null,\n\n  initialize: (context) => {\n    Workflow.runChangeDetector = (items) => {\n     context.changeDetector.markForCheck();\n     return items;\n   }\n  },\n\n  cycle: (direction) =>\n    Observable.create(observer => {\n      Fetch.run(direction)\n      .then(items => Workflow.runChangeDetector(items))\n      .then(items => Render.run(items, direction))\n      .then(items => {\n        Adjust.run(direction, items);\n        Data.position = Elements.viewport.scrollTop;\n\n        if(Clip.run(Direction.opposite(direction))) {\n          Workflow.runChangeDetector(null);\n        }\n        Data.position = Elements.viewport.scrollTop;\n\n        console.log(direction + ' cycle is done');\n        observer.next(direction);\n        observer.complete();\n      })\n      .catch(error => {\n        console.log('Done ' + direction);\n        error && console.error(error);\n        observer.complete();\n      })\n    }),\n\n  run: (param) => {\n    let direction;\n    if(typeof param === 'string') {\n      direction = param;\n    }\n    else {\n      // scroll event\n      console.log('FIRE!');\n      direction = Direction.byScrollTop();\n    }\n    if(!Direction.isValid(direction)) {\n      return;\n    }\n\n    const run = () =>\n      Workflow.cycle(direction).subscribe(run);\n\n    run();\n  }\n};\n\nexport default Workflow\n\n// fetch -> render -> adjust + clip + fetch\n"]}